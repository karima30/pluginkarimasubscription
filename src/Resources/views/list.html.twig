{% if product.program %}
    <h4 class="ui horizontal section divider header">Product choosing</h4>
<div class="ui four doubling cards">
    {% for product in product.program.programDetails  %}
        <div class="ui fluid card">
                {% if product.product.imagesByType('main') is not empty %}
                        {% set source_path = product.product.imagesByType('main').first.path %}
                        {% set original_path = source_path|imagine_filter('sylius_shop_product_original') %}
                        {% set path = source_path|imagine_filter(filter|default('sylius_shop_product_large_thumbnail')) %}
                {% elseif product.product.images.first %}
                        {% set source_path = product.product.images.first.path %}
                        {% set original_path = source_path|imagine_filter('sylius_shop_product_original') %}
                        {% set path = source_path|imagine_filter(filter|default('sylius_shop_product_large_thumbnail')) %}
                {% else %}
                        {% set original_path = '//placehold.it/400x300' %}
                        {% set path = original_path %}
                {% endif %}

                <div data-product-image="{{ path }}" data-product-link="{{ original_path }}"></div>
                <a href="{{ original_path }}" class="ui fluid image" data-lightbox="sylius-product-image">
                        <img src="{{ path }}" id="main-image" alt="{{ product.product.name }}" {{ sylius_test_html_attribute('main-image') }} />
                </a>
                <div class="prd">
                        <button class="minus" rel="{{ product.step }}">-</button>
                        <input type="text" class="quantities" name="quantities[]" value="{{ product.quantity }}">
                        <button class="plus" rel="{{ product.step }}">+</button>
                        <input type="hidden" class="ids" name="ids[]" value="{{ product.product.id }}">
                </div>
        </div>
    {% endfor %}
</div>
    <button type="sublmit" class="send">Validate & submit</button>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script language="javascript">
                $(function(){
                    $prds = [];

                        $('.send').click(function(){
                        $('.prd').each(function(){
                            $prds.push({"id": $(this).find('.ids').val(), "quantity": $(this).find('.quantities').val()})
                        })

                            $.ajax({
                                method: "POST",
                                url: "/en_US/createOrderAlongWithSubscription",
                                data: {selectedProducts:[{"category":16,"products":[{"id":138,"quantity":1},{"id":173,"quantity":1},{"id":174,"quantity":"3"},{"id":197,"quantity":"1"}]},{"category":17,"products":[{"id":139,"quantity":1},{"id":140,"quantity":1},{"id":154,"quantity":1},{"id":192,"quantity":1}]},{"category":12,"products":[{"id":166,"quantity":"2"}]},{"category":13,"products":[{"id":143,"quantity":"1"},{"id":161,"quantity":"1"}]}], program: 2, stabilizationOptions: [13, 14]
                                }})

                        .done(function( msg, textStatus, jqXHR ) {
                            if (!isNaN(msg.id) && jqXHR.status == 201){
                                window.location.href= "/en_US/cart";
                            }
                        });
                        console.log($prds);
                    })

                        $('.minus').click(function(){
                            if (parseInt($(this).next().val()) - parseInt($(this).attr('rel')) >=0)
                                $(this).next().val(parseInt($(this).next().val()) - parseInt($(this).attr('rel')))

                        })

                        $('.plus').click(function(){
                            if (parseInt($(this).prev().val()) + parseInt($(this).attr('rel'))  < 100)
                                $(this).prev().val(parseInt($(this).prev().val()) + parseInt($(this).attr('rel')))

                        })
                })
        </script>
{% endif %}
